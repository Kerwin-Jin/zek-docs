<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  
</body>
<script>
  const PROMISE_CONSTANT = {
    PENDING: 'pending',
    FULFILLED: 'fulfilled',
    REJECTED: 'rejected'
  }
  class MyPromise{
    constructor(executor){
      this._status = PROMISE_CONSTANT.PENDING
      this._value = undefined

      try {
        executor(this._resolve.bind(this), this._reject.bind(this))
      } catch (error) {
        this._reject(error)
      }
    }

    then(onFulfilled, onRejected){
      if(this._status === PROMISE_CONSTANT.FULFILLED){
        onFulfilled(this._value)
      }
      if(this._status === PROMISE_CONSTANT.REJECTED){
        onRejected(this._value)
      }
    }

    _changeStatus(status, data){

      if(this._status !== PROMISE_CONSTANT.PENDING){
        // 状态已经改变了，什么都不做
        return
      }
      this._status = status
      this._value = data
    }

    _resolve(data){
      this._changeStatus(PROMISE_CONSTANT.FULFILLED, data)
    }
    _reject(reason){
      this._changeStatus(PROMISE_CONSTANT.REJECTED, reason)
    }
  }



  const p1 = new MyPromise((resolve, reject)=>{
    reject(1)
  })

  console.log(p1)
  p1.then(res=>{
    console.log(res)
  },(e)=>{
    console.log(e)
  })

  // const p2 = new Promise((resolve, reject)=>{
  //   resolve(1)
  // })
  // p2.then(data=>{
  //   console.log(data)
  // },(reason)=>{
  //   console.log(reason)
  // })
</script>
</html>